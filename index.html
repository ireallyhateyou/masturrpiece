<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>masturrpiece</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23333'/><rect x='20' y='20' width='60' height='60' fill='none' stroke='white' stroke-width='4'/></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Luxurious+Script&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="story-modal" id="storyModal">
        <div class="story-content">
            <div class="story-text">
                <h2 class="story-title" id="storyTitle"></h2>
                <img id="storyImage" class="story-image hidden" alt="">
                <p class="story-paragraph" id="storyParagraph"></p>
            </div>
            <button class="btn story-btn hidden" id="storyNextBtn">next</button>
        </div>
    </div>

    <div class="story-modal" id="hwAccelModal" style="display: none;">
        <div class="story-content">
            <div class="story-text">
                <h2 class="story-title">Hardware Acceleration, Please</h2>
                <p class="story-paragraph">
                    Your browser is using software rendering, which will mess up the tracking. Please enable hardware acceleration.
                </p>
            </div>
            <button class="btn story-btn" id="hwAccelCloseBtn">continue anyway</button>
        </div>
    </div>

    <div class="story-modal" id="webcamModal" style="display: none;">
        <div class="story-content">
            <div class="story-text">
                <img src="images/webcam.png" alt="Webcam" class="story-image">
                <h2 class="story-title">Webcam, Please</h2>
                <p class="story-paragraph">
                    We'll need access to your webcam, since part of the twists in this game involves computer vision. Please click "Allow" when prompted by your browser. This is all client-side so we can't use your webcam for anything else. Thank you!!!
                </p>
            </div>
            <button class="btn story-btn" id="webcamModalBtn">Request Access</button>
        </div>
    </div>

    <div class="container" id="container">
        <h1 class="app-title">masturrpiece</h1>
        <p class="subtitle">paint our chef d'oeuvres, by yourself !</p>
        
        <div class="lore-text hidden" id="loreText">
            <img src="images/webcam.png" alt="Webcam" class="lore-image hidden" id="webcamImage">
            <img src="images/mouse.png" alt="Mouse" class="lore-image hidden" id="mouseImage">
            <p id="loreTextContent">You will be painting with your cursor... for now!</p>
        </div>
        
        <div class="teasing-text hidden" id="teasingText">
            <p id="teasingContent"></p>
        </div>
        
        <div class="toolbar hidden" id="toolsBar">
            <div class="tool-group">
                <button id="colorPickerBtn" class="btn">Color</button>
            </div>
            <div class="tool-group">
                <label for="brushSize">Brush Size:</label>
                <input type="range" id="brushSize" min="1" max="50" value="3">
                <span id="brushSizeValue">3</span>
            </div>
            <div class="tool-group">
                <button id="clearBtn" class="btn">Clear Canvas</button>
                <button id="eraserBtn" class="btn">Eraser</button>
            </div>
        </div>

        <div class="gamebar hidden" id="gameBar">
            <div class="tool-group">
                <button id="startGameBtn" class="btn">Start Challenge</button>
                <button id="peekBtn" class="btn hidden" disabled>Peek (<span id="peeksLeft">3</span>)</button>
                <button id="finishBtn" class="btn hidden" disabled>Finish</button>
            </div>
            <div class="tool-group hidden" id="timerGroup">
                <span id="phaseLabel">Ready</span>
                <div class="timer">
                    <div id="timerBar"></div>
                </div>
                <span id="countdownLabel"></span>
            </div>
        </div>

        <div class="comparison-section hidden" id="comparisonSection">
            <div class="canvas-wrapper">
                <div class="drawing-indicator">
                    <img src="images/mouse.png" alt="Mouse" class="drawing-icon hidden" id="mouseDrawingImage">
                    <img src="images/facetrack.png" alt="Face Tracking" class="drawing-icon hidden" id="faceDrawingImage">
                    <img src="images/facetrack.png" alt="Eye Tracking" class="drawing-icon hidden" id="eyeDrawingImage">
                </div>
                <h3 id="yourDrawingTitle">Your Drawing</h3>
                <div class="canvas-container">
                    <canvas id="canvas"></canvas>
                    <canvas id="referenceCanvas" class="reference-canvas hidden"></canvas>
                    <div id="peekOverlay" class="peek-overlay hidden">
                        <img id="peekOverlayImg" alt="Reference" crossorigin="anonymous">
                    </div>
                    <div id="transitionOverlay" class="transition-overlay hidden">
                        <div class="transition-gradient"></div>
                    </div>
                    <video id="video" autoplay playsinline class="hidden"></video>
                    <canvas id="handWireframeCanvas" class="hidden"></canvas>
                    <div id="noseCursor" class="nose-cursor hidden"></div>
                    <div id="detectionWaitOverlay" class="detection-wait-overlay hidden">
                        <div class="detection-wait-text">Please wait...</div>
                    </div>
                </div>
            </div>
            <div class="grade-wrapper hidden" id="gradeWrapper">
                <div id="gradeDisplay" class="grade-display hidden"></div>
            </div>
            <div class="reference-wrapper hidden" id="referenceWrapper">
                <h3 id="referenceTitle">Reference</h3>
                <div class="reference-container">
                    <img id="monaLisaImg" class="hidden" alt="Reference Painting" crossorigin="anonymous">
                    <div class="painting-facts hidden" id="paintingFacts">
                        <h3 id="factsTitle"></h3>
                        <div id="factsContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="toolbar" id="resultsBar" style="margin-top: 20px;">
            <div id="comparisonResult" class="comparison-result"></div>
        </div>
    </div>

    <div id="finalResultsModal" class="final-results-modal hidden">
        <div class="final-results-content">
            <h2>Your Painter GPA</h2>
            <div id="gpaDisplay" class="gpa-display"></div>
            <h3>Your Gallery</h3>
            <div id="paintingGallery" class="painting-gallery"></div>
            <button id="restartGameBtn" class="btn">Play Again</button>
        </div>
    </div>

    <div id="colorPickerModal" class="color-picker-modal hidden">
        <div class="color-picker-content">
            <h3>Select Color</h3>
            <div id="customColorPicker" class="custom-color-picker"></div>
            <button id="closeColorPicker" class="btn">Close</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>
</html>