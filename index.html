<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>masturrpiece</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Luxurious+Script&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="story-modal" id="storyModal">
        <div class="story-content">
            <div class="story-text">
                <h2 class="story-title" id="storyTitle"></h2>
                <img id="storyImage" class="story-image hidden" alt="">
                <p class="story-paragraph" id="storyParagraph"></p>
            </div>
            <button class="btn story-btn hidden" id="storyNextBtn">next</button>
        </div>
    </div>

    <div class="story-modal" id="hwAccelModal" style="display: none;">
        <div class="story-content">
            <div class="story-text">
                <h2 class="story-title">Hardware Acceleration, Please</h2>
                <p class="story-paragraph">
                    Your browser is using software rendering, which will mess up the tracking. Please enable hardware acceleration.
                </p>
            </div>
            <button class="btn story-btn" id="hwAccelCloseBtn">continue anyway</button>
        </div>
    </div>

    <div class="container" id="container">
        <h1 class="app-title">masturrpiece</h1>
        <p class="subtitle">paint our chef d'oeuvres, by yourself !</p>
        
        <div class="lore-text hidden" id="loreText">
            <img src="images/webcam.png" alt="Webcam" class="lore-image hidden" id="webcamImage">
            <img src="images/mouse.png" alt="Mouse" class="lore-image hidden" id="mouseImage">
            <p id="loreTextContent">You will be painting with your cursor... for now!</p>
        </div>
        
        <div class="toolbar hidden" id="toolsBar">
            <div class="tool-group">
                <label for="colorPicker">Color:</label>
                <input type="color" id="colorPicker" value="#000000">
            </div>
            <div class="tool-group">
                <label for="brushSize">Brush Size:</label>
                <input type="range" id="brushSize" min="1" max="50" value="5">
                <span id="brushSizeValue">5</span>
            </div>
            <div class="tool-group">
                <button id="clearBtn" class="btn">Clear Canvas</button>
                <button id="eraserBtn" class="btn">Eraser</button>
                <button id="brushBtn" class="btn active">Brush</button>
            </div>
        </div>

        <div class="gamebar hidden" id="gameBar">
            <div class="tool-group">
                <button id="startGameBtn" class="btn">Start Challenge</button>
                <button id="peekBtn" class="btn hidden" disabled>Peek (<span id="peeksLeft">3</span>)</button>
                <button id="finishBtn" class="btn hidden" disabled>Finish</button>
            </div>
            <div class="tool-group hidden" id="timerGroup">
                <img src="images/mouse.png" alt="Mouse" class="stage-image hidden" id="mouseStageImage">
                <span id="phaseLabel">Ready</span>
                <div class="timer">
                    <div id="timerBar"></div>
                </div>
                <span id="countdownLabel"></span>
            </div>
        </div>

        <div class="comparison-section hidden" id="comparisonSection">
            <div class="canvas-wrapper">
                <h3>Your Drawing</h3>
                <div class="canvas-container">
                    <canvas id="canvas"></canvas>
                    <video id="video" autoplay playsinline class="hidden"></video>
                    <canvas id="handWireframeCanvas" class="hidden"></canvas>
                    <div id="noseCursor" class="nose-cursor hidden"></div>
                </div>
            </div>
            <div class="reference-wrapper hidden" id="referenceWrapper">
                <h3 id="referenceTitle">Reference</h3>
                <div class="reference-container">
                    <img id="monaLisaImg" class="hidden" alt="Reference Painting" crossorigin="anonymous">
                </div>
            </div>
        </div>

        <div class="toolbar" id="resultsBar" style="margin-top: 20px;">
            <div id="comparisonResult" class="comparison-result"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>
</html>